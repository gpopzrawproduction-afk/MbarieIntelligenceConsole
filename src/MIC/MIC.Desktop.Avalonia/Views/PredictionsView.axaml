<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MIC.Desktop.Avalonia.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1100" d:DesignHeight="800"
             x:Class="MIC.Desktop.Avalonia.Views.PredictionsView"
             x:DataType="vm:PredictionsViewModel"
             Background="#0B0C10">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header -->
        <Border Grid.Row="0"
                Padding="32,24"
                Background="#0B0C10">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0">
                    <TextBlock Text="AI PREDICTIONS"
                               FontSize="32"
                               FontWeight="Thin"
                               Foreground="#FFFFFF"
                               LetterSpacing="4" />
                    <TextBlock Text="Machine learning forecasts and trend analysis"
                               FontSize="14"
                               Foreground="#607D8B"
                               Margin="0,8,0,0" />
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                    <Button Command="{Binding RefreshCommand}"
                            Background="#20FFFFFF"
                            Foreground="#B0BEC5"
                            Padding="16,10"
                            CornerRadius="8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Width="16" Height="16"
                                      Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
                            <TextBlock Text="Refresh" />
                        </StackPanel>
                    </Button>
                    <Button Command="{Binding ExportCommand}"
                            Background="#00E5FF"
                            Foreground="#0B0C10"
                            Padding="20,10"
                            CornerRadius="8"
                            FontWeight="SemiBold">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <PathIcon Width="16" Height="16"
                                      Data="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
                            <TextBlock Text="Export Report" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="32,0,32,32" Spacing="24">
                
                <!-- Prediction Controls -->
                <Border Background="#0D1117"
                        BorderBrush="#15FFFFFF"
                        BorderThickness="1"
                        CornerRadius="12"
                        Padding="24">
                    <Grid ColumnDefinitions="*,*,*,Auto">
                        <StackPanel Grid.Column="0" Margin="0,0,16,0">
                            <TextBlock Text="Metric to Predict"
                                       Foreground="#607D8B"
                                       FontSize="11"
                                       Margin="0,0,0,8" />
                            <ComboBox ItemsSource="{Binding AvailableMetrics}"
                                      SelectedItem="{Binding SelectedMetric}"
                                      Background="#10FFFFFF"
                                      Foreground="#FFFFFF"
                                      HorizontalAlignment="Stretch" />
                        </StackPanel>
                        
                        <StackPanel Grid.Column="1" Margin="0,0,16,0">
                            <TextBlock Text="Forecast Period (Days)"
                                       Foreground="#607D8B"
                                       FontSize="11"
                                       Margin="0,0,0,8" />
                            <Grid ColumnDefinitions="*,50">
                                <Slider Grid.Column="0"
                                        Minimum="7"
                                        Maximum="90"
                                        Value="{Binding ForecastDays}" />
                                <TextBlock Grid.Column="1"
                                           Text="{Binding ForecastDays}"
                                           Foreground="#00E5FF"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </StackPanel>
                        
                        <StackPanel Grid.Column="2" Margin="0,0,16,0">
                            <TextBlock Text="Confidence Level"
                                       Foreground="#607D8B"
                                       FontSize="11"
                                       Margin="0,0,0,8" />
                            <Grid ColumnDefinitions="*,50">
                                <Slider Grid.Column="0"
                                        Minimum="0.7"
                                        Maximum="0.99"
                                        Value="{Binding ConfidenceLevel}" />
                                <TextBlock Grid.Column="1"
                                           Text="{Binding ConfidenceLevel, StringFormat={}{0:P0}}"
                                           Foreground="#00E5FF"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </StackPanel>
                        
                        <Button Grid.Column="3"
                                Command="{Binding GeneratePredictionCommand}"
                                Background="#BF40FF"
                                Foreground="#FFFFFF"
                                Padding="24,12"
                                CornerRadius="8"
                                VerticalAlignment="Bottom">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <PathIcon Width="18" Height="18"
                                          Data="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2Z" />
                                <TextBlock Text="Generate Prediction" FontWeight="SemiBold" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </Border>

                <!-- Prediction Cards Grid -->
                <TextBlock Text="FORECASTED METRICS"
                           FontSize="12"
                           FontWeight="SemiBold"
                           Foreground="#455A64"
                           LetterSpacing="2"
                           Margin="0,8,0,0" />
                
                <ItemsControl ItemsSource="{Binding Predictions}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#0D1117"
                                    BorderBrush="#15FFFFFF"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    Padding="20"
                                    Margin="0,0,16,16"
                                    Width="260">
                                <StackPanel Spacing="12">
                                    <TextBlock Text="{Binding MetricName}"
                                               FontSize="14"
                                               FontWeight="SemiBold"
                                               Foreground="#FFFFFF" />
                                    
                                    <Grid ColumnDefinitions="*,*">
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Current"
                                                       FontSize="10"
                                                       Foreground="#607D8B" />
                                            <TextBlock Text="{Binding FormattedCurrent}"
                                                       FontSize="18"
                                                       FontWeight="Light"
                                                       Foreground="#B0BEC5" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Predicted"
                                                       FontSize="10"
                                                       Foreground="#607D8B" />
                                            <TextBlock Text="{Binding FormattedPredicted}"
                                                       FontSize="18"
                                                       FontWeight="Light"
                                                       Foreground="#00E5FF" />
                                        </StackPanel>
                                    </Grid>
                                    
                                    <Border Height="1" Background="#15FFFFFF" />
                                    
                                    <Grid ColumnDefinitions="*,*">
                                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4">
                                            <PathIcon Width="14" Height="14"
                                                      Foreground="#39FF14"
                                                      Data="M7,15L12,10L17,15H7Z" />
                                            <TextBlock Text="{Binding FormattedChange}"
                                                       Foreground="#39FF14"
                                                       FontWeight="SemiBold" />
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" HorizontalAlignment="Right">
                                            <TextBlock Text="Confidence:"
                                                       Foreground="#607D8B"
                                                       FontSize="11" />
                                            <TextBlock Text="{Binding FormattedConfidence}"
                                                       Foreground="#BF40FF"
                                                       FontSize="11"
                                                       FontWeight="SemiBold" />
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Chart Placeholder -->
                <Border Background="#0D1117"
                        BorderBrush="#15FFFFFF"
                        BorderThickness="1"
                        CornerRadius="12"
                        Height="300"
                        Padding="24">
                    <Grid>
                        <TextBlock Text="?? Prediction Chart"
                                   FontSize="16"
                                   Foreground="#607D8B"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center" />
                        <!-- TODO: Add LiveCharts visualization here -->
                    </Grid>
                </Border>

                <!-- AI Analysis Summary -->
                <Border Background="#0D1117"
                        BorderBrush="#20BF40FF"
                        BorderThickness="1"
                        CornerRadius="12"
                        Padding="24">
                    <StackPanel Spacing="16">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <Border Width="36" Height="36"
                                    CornerRadius="10"
                                    Background="#20BF40FF">
                                <PathIcon Width="20" Height="20"
                                          Foreground="#BF40FF"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Data="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2Z" />
                            </Border>
                            <TextBlock Text="AI Analysis Summary"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="#FFFFFF"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        
                        <TextBlock Text="{Binding PredictionSummary}"
                                   Foreground="#B0BEC5"
                                   FontSize="14"
                                   TextWrapping="Wrap"
                                   LineHeight="24" />
                    </StackPanel>
                </Border>

                <!-- Loading Indicator -->
                <Border IsVisible="{Binding IsLoading}"
                        Background="#80000000"
                        CornerRadius="12"
                        Padding="24">
                    <StackPanel HorizontalAlignment="Center" Spacing="16">
                        <ProgressBar IsIndeterminate="True"
                                     Width="200" />
                        <TextBlock Text="Analyzing data patterns..."
                                   Foreground="#B0BEC5"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
        
    </Grid>

</UserControl>
