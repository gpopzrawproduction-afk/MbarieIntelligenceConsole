<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MIC.Desktop.Avalonia.ViewModels"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="700"
             x:Class="MIC.Desktop.Avalonia.Views.ChatView"
             x:DataType="vm:ChatViewModel"
             Background="#0B0C10">

        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <!-- Existing content moved here -->
            <Grid RowDefinitions="Auto,*,Auto,Auto" Margin="20">
        
        <!-- Page Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,12">
            <TextBlock Text="AI ASSISTANT"
                       Classes="title"
                       Foreground="{StaticResource PrimaryGoldBrush}"/>
            <TextBlock Text="{Binding StatusText}"
                       Classes="subtitle"/>
        </StackPanel>
        
        <!-- Main Content -->
        <Border Grid.Row="1" Classes="glass-card-premium" Padding="16">
            <Grid RowDefinitions="*,Auto,Auto">
                <!-- Messages Area -->
                <ScrollViewer Grid.Row="0"
                              x:Name="MessagesScrollViewer"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Padding="8">
                    <ItemsControl ItemsSource="{Binding Messages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,0,0,12">
                                    <!-- User Message -->
                                    <Border IsVisible="{Binding IsUser}"
                                            Background="{StaticResource GoldenGradient}"
                                            BorderBrush="{StaticResource BorderGoldBrush}"
                                            BorderThickness="1"
                                            CornerRadius="12,12,4,12"
                                            Padding="12"
                                            HorizontalAlignment="Right"
                                            MaxWidth="320">
                                        <TextBlock Text="{Binding Content}"
                                                   Foreground="#0B0C10"
                                                   TextWrapping="Wrap"
                                                   FontSize="13" />
                                    </Border>
                                    
                                    <!-- AI Message -->
                                    <StackPanel IsVisible="{Binding !IsUser}"
                                                Orientation="Horizontal"
                                                HorizontalAlignment="Left">
                                        <!-- AI Avatar -->
                                        <Border Width="28" Height="28"
                                                CornerRadius="8"
                                                Background="{StaticResource BackgroundElevatedBrush}"
                                                VerticalAlignment="Top"
                                                Margin="0,0,8,0">
                                            <TextBlock Text="M"
                                                       FontSize="14"
                                                       FontWeight="Light"
                                                       Foreground="{StaticResource PrimaryGoldBrush}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center" />
                                        </Border>
                                        
                                        <Border Background="{StaticResource BackgroundElevatedBrush}"
                                                BorderBrush="{StaticResource BorderSubtleBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4,12,12,12"
                                                Padding="12"
                                                MaxWidth="300">
                                            <TextBlock Text="{Binding Content}"
                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                       TextWrapping="Wrap"
                                                       FontSize="13" />
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Typing Indicator -->
                <Border Grid.Row="1"
                        IsVisible="{Binding IsAITyping}"
                        Padding="8"
                        Background="Transparent">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Border Width="24" Height="24"
                                CornerRadius="6"
                                Background="{StaticResource BackgroundElevatedBrush}">
                            <TextBlock Text="M"
                                       FontSize="12"
                                       FontWeight="Light"
                                       Foreground="{StaticResource PrimaryGoldBrush}"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Border>
                        <TextBlock Text="AI is thinking..."
                                   FontSize="12"
                                   Foreground="{StaticResource TextTertiaryBrush}"
                                   FontStyle="Italic"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!-- Suggested Questions -->
                <Border Grid.Row="2"
                        IsVisible="{Binding ShowSuggestions}"
                        Padding="8,4"
                        Background="Transparent"
                        BorderBrush="{StaticResource BorderSubtleBrush}"
                        BorderThickness="0,1,0,0">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding SuggestedQuestions}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal" Spacing="8" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Classes="outline-golden"
                                            CornerRadius="16"
                                            Padding="12,6"
                                            Command="{Binding $parent[ItemsControl].((vm:ChatViewModel)DataContext).UseSuggestionCommand}"
                                            CommandParameter="{Binding}">
                                        <TextBlock Text="{Binding}"
                                                   FontSize="11"
                                                   Foreground="{StaticResource TextSecondaryBrush}" />
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Border>

        <!-- Input Area -->
        <Border Grid.Row="3" Padding="12" Background="Transparent">
            <Grid ColumnDefinitions="*,Auto">
                <TextBox Grid.Column="0"
                         Text="{Binding UserInput}"
                         Watermark="Ask anything about your business data..."
                         Background="{StaticResource BackgroundDeepBrush}"
                         BorderBrush="{StaticResource BorderGoldBrush}"
                         BorderThickness="1"
                         CornerRadius="20"
                         Padding="16,10"
                         Foreground="{StaticResource TextPrimaryBrush}"
                         FontSize="13"
                         AcceptsReturn="False"
                         TextWrapping="Wrap">
                    <TextBox.KeyBindings>
                        <KeyBinding Command="{Binding SendMessageCommand}" 
                                    Gesture="Enter" />
                        <KeyBinding Command="{Binding InsertNewLineCommand}" 
                                    Gesture="Shift+Enter" />
                    </TextBox.KeyBindings>
                </TextBox>
                
                <Button Grid.Column="1"
                        Command="{Binding SendMessageCommand}"
                        Classes="golden"
                        Width="40" Height="40"
                        Margin="8,0,0,0"
                        IsEnabled="{Binding CanSend}">
                    <PathIcon Width="18" Height="18"
                              Data="M2,21L23,12L2,3V10L17,12L2,14V21Z" />
                </Button>
            </Grid>
        </Border>
        
    </Grid>
        </ScrollViewer>
</UserControl>
