<UserControl xmlns="https://github.com/avaloniaui"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
         xmlns:vm="using:MIC.Desktop.Avalonia.ViewModels"
         xmlns:conv="using:MIC.Desktop.Avalonia.Converters"
         mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
         x:Class="MIC.Desktop.Avalonia.Views.EmailInboxView"
         x:DataType="vm:EmailInboxViewModel">
    
<Grid ColumnDefinitions="280,*,400">
        
        <!-- LEFT SIDEBAR: Folders & Filters -->
        <Border Grid.Column="0"
                Background="#0D1117"
                BorderBrush="#15FFFFFF"
                BorderThickness="0,0,1,0">
            <ScrollViewer>
                <StackPanel Margin="16">
                    
                    <!-- Account Info -->
                    <Border Background="#15FFFFFF"
                            CornerRadius="8"
                            Padding="12"
                            Margin="0,0,0,16">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <Border Grid.Column="0"
                                    Width="40" Height="40"
                                    CornerRadius="20"
                                    Background="#2000E5FF"
                                    Margin="0,0,12,0">
                                <TextBlock Text="??"
                                           FontSize="20"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center" />
                            </Border>
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="Email Intelligence"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="#FFFFFF" />
                                <TextBlock Text="AI-Powered Inbox"
                                           FontSize="11"
                                           Foreground="#607D8B" />
                            </StackPanel>
                            <Button Grid.Column="2"
                                    Command="{Binding ConnectAccountCommand}"
                                    Background="Transparent"
                                    Padding="8"
                                    ToolTip.Tip="Connect Email Account">
                                <TextBlock Text="?" FontSize="16" />
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Folders -->
                    <TextBlock Text="FOLDERS"
                               FontSize="10"
                               FontWeight="SemiBold"
                               Foreground="#455A64"
                               LetterSpacing="2"
                               Margin="0,0,0,8" />
                    
                    <ItemsControl ItemsSource="{Binding Folders}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Left"
                                        Padding="12,8"
                                        Margin="0,2"
                                        CornerRadius="6">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <TextBlock Text="{Binding Icon}" FontSize="16" />
                                        <TextBlock Text="{Binding Name}" Foreground="#B0BEC5" />
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- AI Categories -->
                    <TextBlock Text="AI CATEGORIES"
                               FontSize="10"
                               FontWeight="SemiBold"
                               Foreground="#455A64"
                               LetterSpacing="2"
                               Margin="0,24,0,8" />

                    <ComboBox ItemsSource="{Binding Categories}"
                              SelectedItem="{Binding SelectedCategory}"
                              DisplayMemberBinding="{Binding Name}"
                              HorizontalAlignment="Stretch"
                              Background="#15FFFFFF"
                              Foreground="#FFFFFF" />

                    <!-- Priority Filter -->
                    <TextBlock Text="PRIORITY"
                               FontSize="10"
                               FontWeight="SemiBold"
                               Foreground="#455A64"
                               LetterSpacing="2"
                               Margin="0,16,0,8" />

                    <ComboBox ItemsSource="{Binding Priorities}"
                              SelectedItem="{Binding SelectedPriority}"
                              DisplayMemberBinding="{Binding Name}"
                              HorizontalAlignment="Stretch"
                              Background="#15FFFFFF"
                              Foreground="#FFFFFF" />

                    <!-- Quick Filters -->
                    <TextBlock Text="QUICK FILTERS"
                               FontSize="10"
                               FontWeight="SemiBold"
                               Foreground="#455A64"
                               LetterSpacing="2"
                               Margin="0,24,0,8" />

                    <CheckBox IsChecked="{Binding ShowUnreadOnly}"
                              Foreground="#B0BEC5"
                              Margin="0,4">
                        <TextBlock Text="Unread only" />
                    </CheckBox>

                    <CheckBox IsChecked="{Binding ShowRequiresResponseOnly}"
                              Foreground="#B0BEC5"
                              Margin="0,4">
                        <TextBlock Text="Requires response" />
                    </CheckBox>

                    <!-- Stats -->
                    <Border Background="#10FFFFFF"
                            CornerRadius="8"
                            Padding="12"
                            Margin="0,24,0,0">
                        <StackPanel Spacing="8">
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="Total Emails" Foreground="#607D8B" FontSize="12" />
                                <TextBlock Grid.Column="1" Text="{Binding TotalEmails}" Foreground="#00E5FF" FontWeight="SemiBold" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="Unread" Foreground="#607D8B" FontSize="12" />
                                <TextBlock Grid.Column="1" Text="{Binding UnreadCount}" Foreground="#FF6B00" FontWeight="SemiBold" />
                            </Grid>
                            <Grid ColumnDefinitions="*,Auto">
                                <TextBlock Grid.Column="0" Text="Needs Response" Foreground="#607D8B" FontSize="12" />
                                <TextBlock Grid.Column="1" Text="{Binding RequiresResponseCount}" Foreground="#FF0055" FontWeight="SemiBold" />
                            </Grid>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- CENTER: Email List -->
        <Border Grid.Column="1"
                Background="#0B0C10">
            <Grid RowDefinitions="Auto,*">
                
                <!-- Search Bar -->
                <Border Grid.Row="0"
                        Background="#0D1117"
                        Padding="16">
                    <Grid ColumnDefinitions="*,Auto,Auto">
                        <Border Grid.Column="0"
                                Background="#15FFFFFF"
                                CornerRadius="8"
                                Padding="12,8">
                            <Grid ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="??" Margin="0,0,8,0" VerticalAlignment="Center" />
                                <TextBox Grid.Column="1"
                                         Text="{Binding SearchText}"
                                         Watermark="Search emails..."
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Foreground="#FFFFFF" />
                            </Grid>
                        </Border>
                        <Button Grid.Column="1"
                                Command="{Binding RefreshCommand}"
                                Background="#20FFFFFF"
                                Foreground="#B0BEC5"
                                Padding="12,8"
                                CornerRadius="8"
                                Margin="8,0,0,0">
                            <TextBlock Text="? Refresh" />
                        </Button>
                        <Button Grid.Column="2"
                                Command="{Binding ExportCommand}"
                                Background="#20FFFFFF"
                                Foreground="#B0BEC5"
                                Padding="12,8"
                                CornerRadius="8"
                                Margin="8,0,0,0">
                            <TextBlock Text="?? Export" />
                        </Button>
                    </Grid>
                </Border>

                <!-- Email List -->
                <ScrollViewer Grid.Row="1">
                    <ItemsControl ItemsSource="{Binding Emails}"
                                  Margin="8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Background="Transparent"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        Padding="0"
                                        Margin="0,2"
                                        CornerRadius="8">
                                    <Border Background="#0D1117"
                                            BorderBrush="#15FFFFFF"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="16">
                                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto">
                                            
                                            <!-- Unread Indicator -->
                                            <Border Grid.Column="0" Grid.RowSpan="3"
                                                    Width="4"
                                                    CornerRadius="2"
                                                    Margin="0,0,12,0"
                                                    IsVisible="{Binding !IsRead}">
                                                <Border.Background>
                                                    <SolidColorBrush Color="{Binding PriorityColor}" />
                                                </Border.Background>
                                            </Border>

                                            <!-- Header: From + Time -->
                                            <Grid Grid.Column="1" Grid.Row="0" ColumnDefinitions="Auto,*,Auto">
                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding CategoryIcon}"
                                                           FontSize="14"
                                                           Margin="0,0,8,0" />
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding SenderDisplay}"
                                                           FontSize="13"
                                                           FontWeight="{Binding IsRead, Converter={x:Static conv:BoolConverters.ToFontWeight}}"
                                                           Foreground="#FFFFFF" />
                                                <TextBlock Grid.Column="2"
                                                           Text="{Binding TimeAgo}"
                                                           FontSize="11"
                                                           Foreground="#607D8B" />
                                            </Grid>

                                            <!-- Subject -->
                                            <TextBlock Grid.Column="1" Grid.Row="1"
                                                       Text="{Binding Subject}"
                                                       FontSize="14"
                                                       FontWeight="{Binding IsRead, Converter={x:Static conv:BoolConverters.ToFontWeight}}"
                                                       Foreground="#E0E0E0"
                                                       TextTrimming="CharacterEllipsis"
                                                       Margin="0,4,0,2" />

                                            <!-- Preview + AI Summary -->
                                            <StackPanel Grid.Column="1" Grid.Row="2" Spacing="4">
                                                <TextBlock Text="{Binding BodyPreview}"
                                                           FontSize="12"
                                                           Foreground="#607D8B"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxLines="1" />
                                                
                                                <!-- AI Badges -->
                                                <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                                    <!-- Priority Badge -->
                                                    <Border CornerRadius="4"
                                                            Padding="6,2"
                                                            IsVisible="{Binding RequiresResponse}">
                                                        <Border.Background>
                                                            <SolidColorBrush Color="#30FF0055" />
                                                        </Border.Background>
                                                        <TextBlock Text="? Response Needed"
                                                                   FontSize="10"
                                                                   Foreground="#FF6B7A" />
                                                    </Border>
                                                    
                                                    <!-- Action Items Badge -->
                                                    <Border CornerRadius="4"
                                                            Padding="6,2"
                                                            Background="#30FF6B00"
                                                            IsVisible="{Binding ContainsActionItems}">
                                                        <TextBlock Text="? Action Items"
                                                                   FontSize="10"
                                                                   Foreground="#FFB74D" />
                                                    </Border>
                                                    
                                                    <!-- Attachment Badge -->
                                                    <Border CornerRadius="4"
                                                            Padding="6,2"
                                                            Background="#20FFFFFF"
                                                            IsVisible="{Binding HasAttachments}">
                                                        <TextBlock Text="??"
                                                                   FontSize="10" />
                                                    </Border>

                                                    <!-- Sentiment -->
                                                    <TextBlock Text="{Binding SentimentIcon}"
                                                               FontSize="12"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Actions -->
                                            <StackPanel Grid.Column="2" Grid.RowSpan="3"
                                                        Orientation="Vertical"
                                                        Spacing="4"
                                                        VerticalAlignment="Center">
                                                <Button Background="Transparent" Padding="6" ToolTip.Tip="Archive">
                                                    <TextBlock Text="??" FontSize="14" />
                                                </Button>
                                                <Button Background="Transparent" Padding="6" ToolTip.Tip="Flag">
                                                    <TextBlock Text="?" FontSize="14" />
                                                </Button>
                                            </StackPanel>

                                        </Grid>
                                    </Border>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>

        <!-- RIGHT SIDEBAR: Email Detail / AI Insights -->
        <Border Grid.Column="2"
                Background="#0D1117"
                BorderBrush="#15FFFFFF"
                BorderThickness="1,0,0,0">
            <ScrollViewer>
                <StackPanel Margin="20">
                    
                    <!-- No Selection State -->
                    <StackPanel IsVisible="{Binding SelectedEmail, Converter={x:Static ObjectConverters.IsNull}}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Margin="0,100">
                        <TextBlock Text="??"
                                   FontSize="48"
                                   HorizontalAlignment="Center"
                                   Opacity="0.5" />
                        <TextBlock Text="Select an email to view"
                                   FontSize="14"
                                   Foreground="#607D8B"
                                   HorizontalAlignment="Center"
                                   Margin="0,16,0,0" />
                        <TextBlock Text="AI insights will appear here"
                                   FontSize="12"
                                   Foreground="#455A64"
                                   HorizontalAlignment="Center" />
                    </StackPanel>

                    <!-- AI Intelligence Panel -->
                    <StackPanel IsVisible="{Binding SelectedEmail, Converter={x:Static ObjectConverters.IsNotNull}}">
                        
                        <TextBlock Text="AI INTELLIGENCE"
                                   FontSize="10"
                                   FontWeight="SemiBold"
                                   Foreground="#455A64"
                                   LetterSpacing="2"
                                   Margin="0,0,0,16" />

                        <!-- AI Summary Card -->
                        <Border Background="#15FFFFFF"
                                CornerRadius="8"
                                Padding="16"
                                Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="?? Summary"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="#00E5FF"
                                           Margin="0,0,0,8" />
                                <TextBlock Text="{Binding SelectedEmail.AISummary}"
                                           FontSize="13"
                                           Foreground="#B0BEC5"
                                           TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>

                        <!-- Quick Actions -->
                        <TextBlock Text="QUICK ACTIONS"
                                   FontSize="10"
                                   FontWeight="SemiBold"
                                   Foreground="#455A64"
                                   LetterSpacing="2"
                                   Margin="0,0,0,12" />

                        <StackPanel Spacing="8">
                            <Button HorizontalAlignment="Stretch"
                                    Background="#2000E5FF"
                                    Foreground="#00E5FF"
                                    Padding="12,10"
                                    CornerRadius="6">
                                <TextBlock Text="?? Draft Reply with AI" />
                            </Button>
                            <Button HorizontalAlignment="Stretch"
                                    Background="#20FFFFFF"
                                    Foreground="#B0BEC5"
                                    Padding="12,10"
                                    CornerRadius="6">
                                <TextBlock Text="?? Extract Action Items" />
                            </Button>
                            <Button HorizontalAlignment="Stretch"
                                    Background="#20FFFFFF"
                                    Foreground="#B0BEC5"
                                    Padding="12,10"
                                    CornerRadius="6">
                                <TextBlock Text="?? Find Related Emails" />
                            </Button>
                        </StackPanel>

                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>
        
    </Grid>
    
</UserControl>
