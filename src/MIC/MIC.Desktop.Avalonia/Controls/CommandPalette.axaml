<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MIC.Desktop.Avalonia.ViewModels"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="400"
             x:Class="MIC.Desktop.Avalonia.Controls.CommandPalette"
             x:DataType="vm:CommandPaletteViewModel"
             IsVisible="{Binding IsOpen}">

    <!-- Backdrop -->
    <Grid>
        <Border Background="#80000000"
                PointerPressed="OnBackdropPressed" />
        
        <!-- Command Palette Dialog -->
        <Border Background="#1A1D24"
                BorderBrush="#2000E5FF"
                BorderThickness="1"
                CornerRadius="12"
                Width="560"
                MaxHeight="450"
                VerticalAlignment="Top"
                Margin="0,100,0,0"
                BoxShadow="0 8 40 0 #60000000">
            
            <StackPanel>
                <!-- Search Input -->
                <Border Background="#10FFFFFF"
                        Padding="16">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Grid.Column="0"
                                   Text="??"
                                   FontSize="18"
                                   Margin="0,0,12,0"
                                   VerticalAlignment="Center"
                                   Opacity="0.6" />
                        <TextBox Grid.Column="1"
                                 x:Name="SearchBox"
                                 Text="{Binding SearchText, Mode=TwoWay}"
                                 Watermark="Type a command or search..."
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Foreground="#FFFFFF"
                                 FontSize="16"
                                 Padding="0"
                                 VerticalAlignment="Center"
                                 KeyDown="OnSearchKeyDown" />
                    </Grid>
                </Border>
                
                <Border Height="1" Background="#15FFFFFF" />
                
                <!-- Results List -->
                <ScrollViewer MaxHeight="350"
                              VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding FilteredCommands}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:CommandItem}">
                                <Button Background="Transparent"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        Padding="16,12"
                                        CornerRadius="0"
                                        Command="{Binding $parent[ItemsControl].((vm:CommandPaletteViewModel)DataContext).ExecuteSelectedCommand}">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- Icon -->
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding Icon}"
                                                   FontSize="18"
                                                   Width="32"
                                                   VerticalAlignment="Center" />
                                        
                                        <!-- Name and Description -->
                                        <StackPanel Grid.Column="1" Spacing="2">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding Name}"
                                                           FontSize="14"
                                                           FontWeight="Medium"
                                                           Foreground="#FFFFFF" />
                                                <Border Background="#15FFFFFF"
                                                        CornerRadius="4"
                                                        Padding="6,2">
                                                    <TextBlock Text="{Binding Category}"
                                                               FontSize="10"
                                                               Foreground="#607D8B" />
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="{Binding Description}"
                                                       FontSize="12"
                                                       Foreground="#607D8B" />
                                        </StackPanel>
                                        
                                        <!-- Shortcut -->
                                        <Border Grid.Column="2"
                                                Background="#10FFFFFF"
                                                CornerRadius="4"
                                                Padding="8,4"
                                                VerticalAlignment="Center"
                                                IsVisible="{Binding Shortcut, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <TextBlock Text="{Binding Shortcut}"
                                                       FontSize="11"
                                                       Foreground="#607D8B"
                                                       FontFamily="Consolas" />
                                        </Border>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                
                <!-- Footer -->
                <Border Background="#10FFFFFF"
                        Padding="16,10">
                    <StackPanel Orientation="Horizontal" Spacing="24">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Border Background="#20FFFFFF" CornerRadius="3" Padding="6,2">
                                <TextBlock Text="??" FontSize="10" Foreground="#607D8B" />
                            </Border>
                            <TextBlock Text="Navigate" FontSize="11" Foreground="#607D8B" VerticalAlignment="Center" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Border Background="#20FFFFFF" CornerRadius="3" Padding="6,2">
                                <TextBlock Text="Enter" FontSize="10" Foreground="#607D8B" />
                            </Border>
                            <TextBlock Text="Select" FontSize="11" Foreground="#607D8B" VerticalAlignment="Center" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Border Background="#20FFFFFF" CornerRadius="3" Padding="6,2">
                                <TextBlock Text="Esc" FontSize="10" Foreground="#607D8B" />
                            </Border>
                            <TextBlock Text="Close" FontSize="11" Foreground="#607D8B" VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>
    </Grid>

</UserControl>
